<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©servation Carpodrome</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; position: relative; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .admin-gear { position: absolute; top: 0; right: 0; font-size: 1.5em; cursor: pointer; opacity: 0.7; transition: 0.3s; }
        .admin-gear:hover { opacity: 1; transform: rotate(90deg); }
        .card { background: white; border-radius: 15px; padding: 30px; margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .card h2 { color: #667eea; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #eee; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group label .required { color: #e53e3e; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; transition: border-color 0.3s, box-shadow 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 600px) { .form-row { grid-template-columns: 1fr; } }
        .month-selector { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        @media (max-width: 600px) { .month-selector { grid-template-columns: repeat(2, 1fr); } }
        .month-btn { padding: 15px 10px; border: 2px solid #e2e8f0; border-radius: 10px; background: white; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; text-align: center; }
        .month-btn:hover { border-color: #667eea; background: #f7f8ff; }
        .month-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .month-btn.disabled { opacity: 0.4; cursor: not-allowed; background: #f5f5f5; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 20px; }
        @media (max-width: 600px) { .days-grid { grid-template-columns: repeat(4, 1fr); } }
        .day-btn { padding: 12px 5px; border: 2px solid #e2e8f0; border-radius: 8px; background: white; cursor: pointer; font-size: 14px; transition: all 0.3s; text-align: center; }
        .day-btn:hover:not(.disabled) { border-color: #667eea; background: #f7f8ff; }
        .day-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .day-btn .day-name { font-size: 10px; color: #888; display: block; }
        .day-btn.active .day-name { color: rgba(255,255,255,0.8); }
        .day-btn.ferme-matin { border-color: #ffc107; background: #fffbeb; }
        .day-btn.ferme-matin::after { content: "‚ö†Ô∏è Ferm√© matin"; display: block; font-size: 9px; color: #b45309; margin-top: 3px; }
        .postes-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 20px; }
        @media (max-width: 600px) { .postes-grid { grid-template-columns: repeat(4, 1fr); } }
        .poste-btn { padding: 20px 10px; border: 2px solid #e2e8f0; border-radius: 10px; background: white; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; text-align: center; }
        .poste-btn:hover:not(.disabled):not(.occupe) { border-color: #28a745; background: #f0fff4; }
        .poste-btn.active { background: #28a745; color: white; border-color: #28a745; }
        .poste-btn.occupe { background: #fee2e2; border-color: #dc3545; cursor: not-allowed; opacity: 0.8; }
        .poste-btn.occupe::after { content: "Occup√©"; display: block; font-size: 10px; color: #dc3545; font-weight: normal; }
        .poste-btn.libre::after { content: "Libre"; display: block; font-size: 10px; color: #28a745; font-weight: normal; }
        .binome-zone { display: none; background: #f0f9ff; border: 2px solid #3182ce; border-radius: 10px; padding: 15px; margin-top: 10px; }
        .binome-zone.visible { display: block; }
        .binome-zone h4 { color: #3182ce; margin-bottom: 10px; }
        .reglement-container { margin: 20px 0; border: 2px solid #667eea; border-radius: 10px; overflow: hidden; }
        .reglement-header { background: #667eea; color: white; padding: 15px; font-weight: bold; text-align: center; }
        .reglement-scroll { height: 400px; overflow-y: scroll; padding: 20px; background: #f8f9fa; font-size: 14px; line-height: 1.6; }
        .reglement-scroll h3 { color: #667eea; margin: 20px 0 10px 0; font-size: 1.1em; }
        .reglement-scroll h3:first-child { margin-top: 0; }
        .reglement-scroll ul { margin-left: 20px; margin-bottom: 15px; }
        .reglement-scroll li { margin-bottom: 5px; }
        .reglement-scroll .interdit { color: #dc3545; }
        .reglement-scroll .important { background: #fff3cd; padding: 10px; border-radius: 5px; border-left: 4px solid #ffc107; margin: 10px 0; }
        .reglement-scroll .contact-box { background: #e7f3ff; padding: 15px; border-radius: 8px; margin-top: 20px; }
        .reglement-progress { background: #e2e8f0; height: 8px; border-radius: 4px; margin: 10px 20px; overflow: hidden; }
        .reglement-progress-bar { background: #667eea; height: 100%; width: 0%; transition: width 0.3s; }
        .reglement-status { text-align: center; padding: 10px; font-size: 13px; color: #666; }
        .reglement-status.complete { color: #28a745; font-weight: bold; }
        .checkbox-group { display: flex; align-items: flex-start; gap: 10px; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .checkbox-group.disabled { opacity: 0.5; }
        .checkbox-group input[type="checkbox"] { width: 22px; height: 22px; margin-top: 3px; cursor: pointer; }
        .checkbox-group input[type="checkbox"]:disabled { cursor: not-allowed; }
        .checkbox-group label { font-size: 14px; color: #333; line-height: 1.5; cursor: pointer; }
        .btn-submit { width: 100%; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; }
        .btn-submit:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .btn-submit:disabled { opacity: 0.5; cursor: not-allowed; }
        .info-box { background: #e7f3ff; border: 2px solid #3182ce; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
        .selection-resume { background: #f0fff4; border: 2px solid #28a745; border-radius: 10px; padding: 15px; margin: 20px 0; }
        .selection-resume h4 { color: #28a745; margin-bottom: 10px; }
        .selection-resume p { margin: 5px 0; color: #333; }
        .selection-resume strong { color: #667eea; }
        .hidden { display: none !important; }
        .step-indicator { display: flex; justify-content: center; margin-bottom: 30px; }
        .step { display: flex; align-items: center; color: white; opacity: 0.5; }
        .step.active { opacity: 1; }
        .step-num { width: 35px; height: 35px; border-radius: 50%; background: white; color: #667eea; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 8px; }
        .step.active .step-num { background: #ffc107; color: #333; }
        .step-line { width: 50px; height: 3px; background: rgba(255,255,255,0.3); margin: 0 15px; }
        .loading { text-align: center; padding: 40px; }
        .loading-spinner { width: 50px; height: 50px; border: 5px solid #e2e8f0; border-top: 5px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .footer { text-align: center; color: white; margin-top: 30px; opacity: 0.8; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 15px; max-width: 500px; width: 100%; overflow: hidden; animation: modalIn 0.3s; }
        .modal-content.large { max-width: 700px; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .modal-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
        .modal-body { padding: 30px; }
        .modal-body .icon { font-size: 4em; margin-bottom: 20px; text-align: center; }
        .modal-body h3 { margin-bottom: 15px; color: #333; text-align: center; }
        .modal-body p { color: #666; margin-bottom: 10px; }
        .modal-btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .modal-btn.primary { background: #667eea; color: white; }
        .modal-btn.primary:hover { background: #5a6fd6; }
        .modal-btn.success { background: #28a745; color: white; }
        .admin-textarea { width: 100%; min-height: 200px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; font-family: inherit; line-height: 1.6; resize: vertical; }
        .admin-textarea:focus { outline: none; border-color: #667eea; }
        .admin-help { background: #f8f9fa; border-radius: 8px; padding: 15px; margin-top: 15px; font-size: 13px; }
        .admin-help h4 { color: #667eea; margin-bottom: 10px; }
        .admin-help code { background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <span class="admin-gear" onclick="openAdminModal()">‚öôÔ∏è</span>
            <h1>üé£ Carpodrome</h1>
            <p>R√©servation de poste de p√™che</p>
        </div>
        <div class="step-indicator">
            <div class="step active" id="step1"><span class="step-num">1</span><span>Date</span></div>
            <div class="step-line"></div>
            <div class="step" id="step2"><span class="step-num">2</span><span>Poste</span></div>
            <div class="step-line"></div>
            <div class="step" id="step3"><span class="step-num">3</span><span>Infos</span></div>
        </div>
        <div class="card" id="etape1">
            <h2>üìÖ √âtape 1 : Choisissez votre date</h2>
            <div class="info-box" id="infoBoxHoraires"></div>
            <label style="font-weight: 600; margin-bottom: 10px; display: block;">S√©lectionnez un mois :</label>
            <div class="month-selector" id="monthSelector"></div>
            <div id="daysContainer" class="hidden">
                <label style="font-weight: 600; margin-bottom: 10px; display: block;">S√©lectionnez un jour :</label>
                <div class="days-grid" id="daysGrid"></div>
            </div>
        </div>
        <div class="card hidden" id="etape2">
            <h2>üé£ √âtape 2 : Choisissez votre poste</h2>
            <div id="loadingPostes" class="loading"><div class="loading-spinner"></div><p>Chargement des disponibilit√©s...</p></div>
            <div id="postesContainer" class="hidden">
                <div class="info-box" id="dateSelectedInfo"></div>
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">üìç Plan du Carpodrome :</label>
                    <div style="text-align: center; background: #f8f9fa; padding: 15px; border-radius: 10px; border: 2px solid #e2e8f0;">
                        <img src="plan_carpodrome_numeros.jpg" alt="Plan du Carpodrome" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); cursor: pointer;" onclick="document.getElementById('modalPlan').classList.add('active')">
                        <p style="margin-top: 10px; font-size: 0.9em; color: #666;">üëÜ Cliquez sur l'image pour l'agrandir</p>
                    </div>
                </div>
                <label style="font-weight: 600; margin-bottom: 10px; display: block;">S√©lectionnez un poste libre :</label>
                <div class="postes-grid" id="postesGrid"></div>
                <div class="form-group">
                    <label>Cr√©neau <span class="required">*</span></label>
                    <select id="creneau" required>
                        <option value="">-- S√©lectionnez un cr√©neau --</option>
                        <option value="Le matin">üåÖ Le matin</option>
                        <option value="L'apr√®s midi">‚òÄÔ∏è L'apr√®s midi</option>
                        <option value="La journ√©e">üìÖ La journ√©e</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mode de p√™che <span class="required">*</span></label>
                    <select id="modePeche" onchange="toggleBinome()">
                        <option value="Individuel">üë§ Individuel</option>
                        <option value="Am√©ricaine">üë• Am√©ricaine (bin√¥me)</option>
                    </select>
                </div>
                <div class="binome-zone" id="binomeZone">
                    <h4>üë• Informations du bin√¥me</h4>
                    <div class="form-group">
                        <label>Nom et pr√©nom du bin√¥me <span class="required">*</span></label>
                        <input type="text" id="binomeNom" placeholder="Ex: DUPONT Jean">
                    </div>
                </div>
                <button class="btn-submit" onclick="goToStep3()">Continuer ‚Üí</button>
            </div>
        </div>
        <div class="card hidden" id="etape3">
            <h2>üë§ √âtape 3 : Vos informations</h2>
            <div class="selection-resume" id="selectionResume"></div>
            <div class="form-row">
                <div class="form-group"><label>Nom <span class="required">*</span></label><input type="text" id="nom" placeholder="DUPONT" style="text-transform: uppercase;"></div>
                <div class="form-group"><label>Pr√©nom <span class="required">*</span></label><input type="text" id="prenom" placeholder="Jean"></div>
            </div>
            <div class="form-group"><label>Adresse <span class="required">*</span></label><input type="text" id="adresse" placeholder="123 rue de la P√™che"></div>
            <div class="form-row">
                <div class="form-group"><label>Code postal <span class="required">*</span></label><input type="text" id="codePostal" placeholder="67000"></div>
                <div class="form-group"><label>Ville <span class="required">*</span></label><input type="text" id="ville" placeholder="Strasbourg"></div>
            </div>
            <div class="form-group"><label>Num√©ro de t√©l√©phone <span class="required">*</span></label><input type="tel" id="telephone" placeholder="06 12 34 56 78"></div>
            <div class="form-group"><label>Adresse e-mail <span class="required">*</span></label><input type="email" id="email" placeholder="exemple@email.com"></div>
            <div class="reglement-container">
                <div class="reglement-header">üìú R√àGLEMENT DU CARPODROME - √Ä LIRE OBLIGATOIREMENT</div>
                <div class="reglement-scroll" id="reglementScroll" onscroll="checkReglementScroll()">
                    <h3>üóìÔ∏è P√âRIODES ET HORAIRES D'OUVERTURE</h3>
                    <p>Les horaires de p√™che : 30 minutes avant le lever du soleil ‚Üí 30 minutes apr√®s le coucher</p>
                    <ul><li>Sur r√©servation uniquement et 24h √† l'avance</li><li>Du 1er mars au 4 mai : samedis, dimanches et jours f√©ri√©s</li><li>Du 5 mai au 30 octobre : tous les jours</li><li>P√™che de 8h √† 19h - P√©riode de mars √† avril et p√©riode de septembre √† fin octobre</li><li>P√™che de 8h √† 20h - P√©riode de mai √† fin ao√ªt</li></ul>
                    <p class="important">‚ö†Ô∏è L'AAPPMA peut √† tout moment fermer les √©tangs pour cause d'√©v√©nements ind√©pendants de notre volont√©</p>
                    <h3>üé´ R√âSERVATION ET TARIFS</h3>
                    <ul><li>Carte journali√®re : 10 ‚Ç¨ / Titulaires de la carte annuelle : 5 ‚Ç¨</li><li>Carte demi-journ√©e : 6 ‚Ç¨ / Titulaires de la carte annuelle : 3 ‚Ç¨</li><li>Jours d'√©v√©nements : p√™che payante pour tous (10 ‚Ç¨)</li><li>R√©servation obligatoire 24h avant via formulaire en ligne</li></ul>
                    <p class="important">‚ö†Ô∏è Il est imp√©ratif que chaque p√™cheur dispose de la somme exacte pour l'achat d'une carte.</p>
                    <h3>üé£ MODALIT√âS DE P√äCHE</h3>
                    <ul><li><strong>P√™che No Kill obligatoire</strong></li><li>Canne au coup uniquement, longueur max : 13 m</li><li>1 ligne par p√™cheur</li><li>Max 2 p√™cheurs par poste</li><li>P√™che sous la canne, dans la zone du poste r√©serv√©</li><li>Amor√ßage : uniquement √† la coupelle ou fronde</li><li>Mat√©riel obligatoire : bassine ou tapis de r√©ception √©pais avec rebord (5cm mini)</li><li>Hame√ßon sans ardillon, taille max n¬∫10</li><li>Bourriche autoris√©e pour poisson blanc uniquement</li><li>Carpes et tanches : rel√¢ch√©es imm√©diatement</li><li>Esches autoris√©es : v√©g√©tales, vers de terre, asticots</li><li>Pellets et baby corn autoris√©s</li><li>Graines cuites obligatoirement</li></ul>
                    <h3>üë∂ P√äCHE DES MINEURS</h3>
                    <ul><li>Autoris√©e √† partir de 12 ans, en journ√©e uniquement</li><li>Moins de 12 ans : accompagnement obligatoire</li></ul>
                    <h3>üëÆ CONTR√îLES ET SANCTIONS</h3>
                    <ul><li>Carte de p√™che √† pr√©senter</li><li>Contr√¥les r√©guliers et impr√©vus</li></ul>
                    <p><strong>Sanctions :</strong></p>
                    <ul><li>1√®re infraction ‚Üí avertissement</li><li>2√®me infraction ‚Üí exclusion temporaire ou d√©finitive</li><li>Aucun remboursement en cas d'exclusion</li></ul>
                    <h3>‚õî INTERDICTIONS</h3>
                    <ul class="interdit"><li>‚ùå Feux au sol et barbecues</li><li>‚ùå P√™che de nuit</li><li>‚ùå Camping (seuls parapluies autoris√©s)</li><li>‚ùå Baignade, canotage</li><li>‚ùå Mutilation ou marquage des poissons</li><li>‚ùå Franglaise, Feeder</li><li>‚ùå Graines crues</li><li>‚ùå P√™che au pain</li><li>‚ùå Hame√ßons avec ardillons</li><li>‚ùå P√™che en surface</li></ul>
                    <h3>üóëÔ∏è GESTION DES D√âCHETS</h3>
                    <ul><li>Ramener ses d√©chets</li><li>Amende possible : 150 ‚Ç¨</li></ul>
                    <div class="contact-box">
                        <h3>üìû CONTACTS UTILES</h3>
                        <ul><li><strong>Pr√©sident :</strong> Ren√© Rahm ‚Äì 06.50.76.59.34</li><li><strong>Probl√®me sur r√©servations :</strong> Patrice Walter ‚Äì 06.37.70.37.31</li><li><strong>Garde p√™che :</strong> Raymond Ledig ‚Äì 06.95.24.90.84</li></ul>
                        <p style="margin-top: 15px;">üåê <a href="https://www.aappma-gundershoffen.fr" target="_blank">www.aappma-gundershoffen.fr</a></p>
                    </div>
                    <div style="height: 50px;"></div>
                    <p style="text-align: center; font-weight: bold; color: #28a745;">‚úÖ Vous avez lu l'int√©gralit√© du r√®glement</p>
                    <div style="height: 20px;"></div>
                </div>
                <div class="reglement-progress"><div class="reglement-progress-bar" id="progressBar"></div></div>
                <div class="reglement-status" id="reglementStatus">‚¨áÔ∏è Faites d√©filer pour lire le r√®glement complet</div>
            </div>
            <div class="checkbox-group disabled" id="checkboxGroup">
                <input type="checkbox" id="reglement" disabled>
                <label for="reglement">J'ai lu et j'accepte le r√®glement int√©rieur du Carpodrome. Je m'engage √† respecter les r√®gles de p√™che et de bonne conduite sur le site. <span class="required">*</span></label>
            </div>
            <button class="btn-submit" onclick="submitReservation()" id="btnSubmit" disabled>‚úÖ Confirmer ma r√©servation</button>
        </div>
        <div class="footer"><p>¬© Carpodrome AAPPMA Gundershoffen - Tous droits r√©serv√©s</p></div>
    </div>
    
    <!-- Modal Password -->
    <div class="modal" id="modalPassword">
        <div class="modal-content">
            <div class="modal-header"><h2>üîê Administration</h2></div>
            <div class="modal-body">
                <div class="icon">üîí</div>
                <h3>Acc√®s prot√©g√©</h3>
                <div class="form-group"><label>Mot de passe :</label><input type="password" id="adminPassword" placeholder="Entrez le mot de passe" onkeyup="if(event.key === 'Enter') checkAdminPassword()"></div>
                <p id="passwordError" style="color: #dc3545; display: none; text-align: center;">‚ùå Mot de passe incorrect</p>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="modal-btn primary" onclick="checkAdminPassword()">Valider</button>
                    <button class="modal-btn" onclick="closeModal('modalPassword')" style="background: #6c757d; color: white;">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Admin -->
    <div class="modal" id="modalAdmin">
        <div class="modal-content large">
            <div class="modal-header"><h2>‚öôÔ∏è Administration</h2></div>
            <div class="modal-body">
                <div class="form-group"><label>Contenu du cadre bleu "Horaires" :</label><textarea class="admin-textarea" id="adminInfoContent"></textarea></div>
                <div class="admin-help">
                    <h4>üí° Balises HTML disponibles :</h4>
                    <p><code>&lt;h4&gt;Titre&lt;/h4&gt;</code> - Titre</p>
                    <p><code>&lt;p&gt;Texte&lt;/p&gt;</code> - Paragraphe</p>
                    <p><code>&lt;strong&gt;Gras&lt;/strong&gt;</code> - Texte en gras</p>
                    <p><code>&lt;br&gt;</code> - Retour √† la ligne</p>
                </div>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                    <button class="modal-btn success" onclick="saveAdminContent()">üíæ Enregistrer</button>
                    <button class="modal-btn" onclick="closeModal('modalAdmin')" style="background: #6c757d; color: white;">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Succ√®s -->
    <div class="modal" id="modalSuccess">
        <div class="modal-content">
            <div class="modal-header"><h2>R√©servation envoy√©e !</h2></div>
            <div class="modal-body">
                <div class="icon">‚úÖ</div>
                <h3>Merci pour votre r√©servation !</h3>
                <p>Votre demande a bien √©t√© enregistr√©e.</p>
                <p><strong>‚ö†Ô∏è Important :</strong> Votre r√©servation doit √™tre valid√©e par notre √©quipe.</p>
                <p>Vous recevrez une confirmation par SMS.</p>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px;">
                    <button class="modal-btn primary" onclick="resetForm()">üîÑ Nouvelle r√©servation</button>
                    <button class="modal-btn" onclick="window.close(); closeModal('modalSuccess');" style="background: #6c757d; color: white;">‚úñ Fermer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Banni -->
    <div class="modal" id="modalBanni">
        <div class="modal-content">
            <div class="modal-header" style="background: #dc3545;"><h2>üö´ R√©servation impossible</h2></div>
            <div class="modal-body">
                <div class="icon">üö´</div>
                <h3>Vous ne pouvez pas r√©server</h3>
                <p>Votre acc√®s au Carpodrome a √©t√© suspendu.</p>
                <button class="modal-btn primary" onclick="closeModal('modalBanni')">Fermer</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Plan -->
    <div class="modal" id="modalPlan" onclick="closeModal('modalPlan')">
        <div style="max-width: 95%; max-height: 95%; position: relative;">
            <img src="plan_carpodrome_numeros.jpg" alt="Plan du Carpodrome" style="max-width: 100%; max-height: 90vh; border-radius: 10px;">
            <button onclick="closeModal('modalPlan')" style="position: absolute; top: -15px; right: -15px; width: 40px; height: 40px; border-radius: 50%; background: white; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
        </div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyAQDfPFUMrEQGxgY8JRufTTjYT1HknQ31WXOaid0w6Qfy9UBsSP-_UVW3t3az-F_ZZGg/exec";
        const ADMIN_PASSWORD = "admincarpodrome";
        const DEFAULT_INFO_CONTENT = `<h4>üìå Horaires d'ouverture</h4>
<p><strong>Du 1er mars au 4 mai :</strong> Samedis, Dimanches et jours f√©ri√©s</p>
<p><strong>Du 5 mai au 30 octobre :</strong> Tous les jours</p>
<p style="margin-top: 10px; font-size: 0.9em;">‚Ä¢ P√™che de 8h √† 19h (mars-avril et septembre-octobre)</p>
<p style="font-size: 0.9em;">‚Ä¢ P√™che de 8h √† 20h (mai √† ao√ªt)</p>`;
        
        const JOURS_OUVERTURE = { 2: [1,7,8,14,15,21,22,28,29], 3: [11,12,18,19,25,26], 4: [2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31], 5: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30], 6: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31], 7: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31], 8: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30], 9: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30] };
        const FERME_MATIN = { 2: [28], 3: [25], 5: [13], 8: [19], 9: [17] };
        const MOIS_NOMS = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
        const JOURS_SEMAINE = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
        
        let selectedMonth = null, selectedDay = null, selectedPoste = null, selectedDateKey = null, selectedDateFull = null;
        let reservationsData = {}, bannisData = [], reglementLu = false;
        
        document.addEventListener('DOMContentLoaded', function() {
            loadInfoBoxContent();
            renderMonths();
            loadData();
            document.getElementById('reglement').addEventListener('change', function() {
                document.getElementById('btnSubmit').disabled = !this.checked;
            });
        });
        
        function openAdminModal() {
            document.getElementById('adminPassword').value = '';
            document.getElementById('passwordError').style.display = 'none';
            document.getElementById('modalPassword').classList.add('active');
            setTimeout(() => document.getElementById('adminPassword').focus(), 100);
        }
        
        function checkAdminPassword() {
            if (document.getElementById('adminPassword').value === ADMIN_PASSWORD) {
                closeModal('modalPassword');
                document.getElementById('adminInfoContent').value = localStorage.getItem('carpodromeInfoContent') || DEFAULT_INFO_CONTENT;
                document.getElementById('modalAdmin').classList.add('active');
            } else {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }
        
        function saveAdminContent() {
            const content = document.getElementById('adminInfoContent').value;
            localStorage.setItem('carpodromeInfoContent', content);
            document.getElementById('infoBoxHoraires').innerHTML = content;
            closeModal('modalAdmin');
            alert('‚úÖ Modifications enregistr√©es !');
        }
        
        function loadInfoBoxContent() {
            document.getElementById('infoBoxHoraires').innerHTML = localStorage.getItem('carpodromeInfoContent') || DEFAULT_INFO_CONTENT;
        }
        
        function loadData() {
            const script = document.createElement('script');
            script.src = GOOGLE_SCRIPT_URL + '?callback=handleData&t=' + Date.now();
            document.body.appendChild(script);
        }
        
        function handleData(data) {
            if (data.status === 'success') {
                if (data.reservations) data.reservations.forEach(r => { if (!reservationsData[r.dateJour]) reservationsData[r.dateJour] = {}; reservationsData[r.dateJour][r.poste] = r; });
                if (data.bannis) bannisData = data.bannis;
            }
        }
        
        function checkReglementScroll() {
            const scrollBox = document.getElementById('reglementScroll');
            const scrollPercent = (scrollBox.scrollTop / (scrollBox.scrollHeight - scrollBox.clientHeight)) * 100;
            document.getElementById('progressBar').style.width = Math.min(scrollPercent, 100) + '%';
            if (scrollPercent >= 95) {
                reglementLu = true;
                document.getElementById('checkboxGroup').classList.remove('disabled');
                document.getElementById('reglement').disabled = false;
                document.getElementById('reglementStatus').textContent = '‚úÖ R√®glement lu - Vous pouvez maintenant cocher la case ci-dessous';
                document.getElementById('reglementStatus').classList.add('complete');
            }
        }
        
        function renderMonths() {
            const container = document.getElementById('monthSelector');
            container.innerHTML = '';
            MOIS_NOMS.forEach((nom, index) => {
                const hasJours = JOURS_OUVERTURE[index] && JOURS_OUVERTURE[index].length > 0;
                if (hasJours) {
                    const btn = document.createElement('div');
                    btn.className = 'month-btn';
                    btn.textContent = nom;
                    btn.onclick = () => selectMonth(index, nom);
                    container.appendChild(btn);
                }
            });
        }
        
        function selectMonth(index, nom) {
            selectedMonth = index; selectedDay = null; selectedPoste = null;
            document.querySelectorAll('.month-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('daysContainer').classList.remove('hidden');
            renderDays(index);
        }
        
        function renderDays(monthIndex) {
            const container = document.getElementById('daysGrid');
            container.innerHTML = '';
            const jours = JOURS_OUVERTURE[monthIndex] || [];
            const fermeMatin = FERME_MATIN[monthIndex] || [];
            jours.forEach(jour => {
                const date = new Date(2026, monthIndex, jour);
                const btn = document.createElement('div');
                btn.className = 'day-btn' + (fermeMatin.includes(jour) ? ' ferme-matin' : '');
                btn.innerHTML = `<span class="day-name">${JOURS_SEMAINE[date.getDay()]}</span><strong>${jour}</strong>`;
                btn.onclick = () => selectDay(jour, monthIndex);
                container.appendChild(btn);
            });
        }
        
        function selectDay(jour, monthIndex) {
            selectedDay = jour; selectedPoste = null;
            selectedDateKey = `2026-${String(monthIndex + 1).padStart(2, '0')}-${String(jour).padStart(2, '0')}`;
            selectedDateFull = new Date(2026, monthIndex, jour).toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
            document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.day-btn').classList.add('active');
            goToStep2();
        }
        
        function goToStep2() {
            document.getElementById('etape2').classList.remove('hidden');
            document.getElementById('step2').classList.add('active');
            document.getElementById('loadingPostes').classList.remove('hidden');
            document.getElementById('postesContainer').classList.add('hidden');
            const script = document.createElement('script');
            script.src = GOOGLE_SCRIPT_URL + '?callback=handleDataAndShowPostes&t=' + Date.now();
            document.body.appendChild(script);
            document.getElementById('etape2').scrollIntoView({ behavior: 'smooth' });
        }
        
        function handleDataAndShowPostes(data) {
            if (data.status === 'success') {
                reservationsData = {};
                if (data.reservations) data.reservations.forEach(r => { if (!reservationsData[r.dateJour]) reservationsData[r.dateJour] = {}; reservationsData[r.dateJour][r.poste] = r; });
                if (data.bannis) bannisData = data.bannis;
            }
            renderPostes();
        }
        
        function renderPostes() {
            document.getElementById('loadingPostes').classList.add('hidden');
            document.getElementById('postesContainer').classList.remove('hidden');
            const fermeMatin = FERME_MATIN[selectedMonth] && FERME_MATIN[selectedMonth].includes(selectedDay);
            let infoHtml = `<h4>üìÖ ${selectedDateFull}</h4>`;
            if (fermeMatin) infoHtml += `<p style="color: #b45309; margin-top: 5px;">‚ö†Ô∏è Ferm√© le matin - R√©servation possible uniquement l'apr√®s-midi</p>`;
            document.getElementById('dateSelectedInfo').innerHTML = infoHtml;
            const creneauSelect = document.getElementById('creneau');
            if (fermeMatin) {
                creneauSelect.innerHTML = `<option value="">-- S√©lectionnez un cr√©neau --</option><option value="L'apr√®s midi">‚òÄÔ∏è L'apr√®s midi</option>`;
                creneauSelect.value = "L'apr√®s midi";
            } else {
                creneauSelect.innerHTML = `<option value="">-- S√©lectionnez un cr√©neau --</option><option value="Le matin">üåÖ Le matin</option><option value="L'apr√®s midi">‚òÄÔ∏è L'apr√®s midi</option><option value="La journ√©e">üìÖ La journ√©e</option>`;
                creneauSelect.value = "";
            }
            const container = document.getElementById('postesGrid');
            container.innerHTML = '';
            const dayReservations = reservationsData[selectedDateKey] || {};
            for (let i = 1; i <= 14; i++) {
                const isOccupe = dayReservations[i] && dayReservations[i].nom;
                const btn = document.createElement('div');
                btn.className = 'poste-btn' + (isOccupe ? ' occupe' : ' libre');
                btn.innerHTML = `<span class="poste-num">Poste ${i}</span>`;
                if (!isOccupe) btn.onclick = () => selectPoste(i);
                container.appendChild(btn);
            }
        }
        
        function selectPoste(num) {
            selectedPoste = num;
            document.querySelectorAll('.poste-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.poste-btn').classList.add('active');
        }
        
        function toggleBinome() {
            document.getElementById('binomeZone').classList.toggle('visible', document.getElementById('modePeche').value === 'Am√©ricaine');
        }
        
        function goToStep3() {
            if (!selectedPoste) { alert('Veuillez s√©lectionner un poste.'); return; }
            const creneau = document.getElementById('creneau').value;
            if (!creneau) { alert('Veuillez s√©lectionner un cr√©neau.'); return; }
            const mode = document.getElementById('modePeche').value;
            if (mode === 'Am√©ricaine' && !document.getElementById('binomeNom').value.trim()) { alert('Veuillez entrer le nom du bin√¥me.'); return; }
            let html = `<h4>üìã R√©capitulatif de votre r√©servation</h4><p>üìÖ Date : <strong>${selectedDateFull}</strong></p><p>üé£ Poste : <strong>Poste ${selectedPoste}</strong></p><p>‚è∞ Cr√©neau : <strong>${creneau}</strong></p><p>üë§ Mode : <strong>${mode}</strong></p>`;
            if (mode === 'Am√©ricaine') html += `<p>üë• Bin√¥me : <strong>${document.getElementById('binomeNom').value}</strong></p>`;
            document.getElementById('selectionResume').innerHTML = html;
            document.getElementById('etape3').classList.remove('hidden');
            document.getElementById('step3').classList.add('active');
            document.getElementById('etape3').scrollIntoView({ behavior: 'smooth' });
        }
        
        function submitReservation() {
            const nom = document.getElementById('nom').value.trim().toUpperCase();
            const prenom = document.getElementById('prenom').value.trim();
            const adresse = document.getElementById('adresse').value.trim();
            const codePostal = document.getElementById('codePostal').value.trim();
            const ville = document.getElementById('ville').value.trim();
            const telephone = document.getElementById('telephone').value.trim();
            const email = document.getElementById('email').value.trim();
            if (!nom) { alert('Veuillez entrer votre nom.'); return; }
            if (!prenom) { alert('Veuillez entrer votre pr√©nom.'); return; }
            if (!adresse) { alert('Veuillez entrer votre adresse.'); return; }
            if (!codePostal) { alert('Veuillez entrer votre code postal.'); return; }
            if (!ville) { alert('Veuillez entrer votre ville.'); return; }
            if (!telephone) { alert('Veuillez entrer votre t√©l√©phone.'); return; }
            if (!email) { alert('Veuillez entrer votre e-mail.'); return; }
            if (!reglementLu) { alert('Veuillez lire le r√®glement en entier.'); return; }
            if (!document.getElementById('reglement').checked) { alert('Veuillez accepter le r√®glement.'); return; }
            if (bannisData.some(b => b.nom && b.nom.toUpperCase() === nom && b.prenom && b.prenom.toLowerCase() === prenom.toLowerCase())) { document.getElementById('modalBanni').classList.add('active'); return; }
            const btn = document.getElementById('btnSubmit');
            btn.disabled = true; btn.textContent = '‚è≥ Envoi en cours...';
            const dateParts = selectedDateKey.split('-');
            const data = { type: "reservation", horodateur: new Date().toLocaleString('fr-FR'), email: email, nomPrenom: nom + ' ' + prenom, adresse: adresse, codePostal: codePostal, ville: ville, telephone: telephone, dateReservation: `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`, poste: "Poste " + selectedPoste, creneau: document.getElementById('creneau').value, mode: document.getElementById('modePeche').value, binome: document.getElementById('modePeche').value === 'Am√©ricaine' ? document.getElementById('binomeNom').value.trim() : '', reglement: "Oui" };
            fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })
            .then(() => { document.getElementById('modalSuccess').classList.add('active'); })
            .catch(error => { alert('Erreur: ' + error.message); })
            .finally(() => { btn.disabled = false; btn.textContent = '‚úÖ Confirmer ma r√©servation'; });
        }
        
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        
        function resetForm() {
            closeModal('modalSuccess');
            selectedMonth = null; selectedDay = null; selectedPoste = null; selectedDateKey = null; selectedDateFull = null; reglementLu = false;
            document.querySelectorAll('.month-btn, .day-btn, .poste-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('daysContainer').classList.add('hidden');
            document.getElementById('etape2').classList.add('hidden');
            document.getElementById('etape3').classList.add('hidden');
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.remove('active');
            document.getElementById('creneau').value = '';
            document.getElementById('modePeche').value = 'Individuel';
            document.getElementById('binomeNom').value = '';
            document.getElementById('binomeZone').classList.remove('visible');
            ['nom','prenom','adresse','codePostal','ville','telephone','email'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('reglement').checked = false;
            document.getElementById('reglement').disabled = true;
            document.getElementById('checkboxGroup').classList.add('disabled');
            document.getElementById('btnSubmit').disabled = true;
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('reglementStatus').textContent = '‚¨áÔ∏è Faites d√©filer pour lire le r√®glement complet';
            document.getElementById('reglementStatus').classList.remove('complete');
            document.getElementById('reglementScroll').scrollTop = 0;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            loadData();
        }
    </script>
</body>
</html>
